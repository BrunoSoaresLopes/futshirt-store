<section class="py-5 text-white" style="background-color: #0a2a08; min-height: 60vh">
  <div class="container px-4 px-lg-5">
    <h2 class="text-center mb-4 text-white">Meu Carrinho</h2>

    <div *ngIf="itensVisiveis.length > 0; else carrinhoVazio">
      <div class="table-responsive">
        <table class="table table-dark table-striped align-middle">
          <thead>
            <tr>
              <th scope="col" style="width: 15%">Produto</th>
              <th scope="col" style="width: 35%"></th>
              <th scope="col">Preço</th>
              <th scope="col">Tamanho</th>
              <th scope="col">Qtd.</th>
              <th scope="col">Subtotal</th>
              <th scope="col">Ações</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of itensVisiveis">
              <td>
                <img
                  [src]="item.produto.imagemUrl"
                  [alt]="item.produto.nome"
                  class="img-fluid"
                  style="max-width: 75px; background-color: #fff; border-radius: 4px"
                />
              </td>
              <td>{{ item.produto.nome }}</td>
              <td>{{ item.produto.preco | currency : 'BRL' }}</td>
              <td>{{ item.tamanho | uppercase }}</td>
              <td>{{ item.quantidade }}</td>
              <td>{{ item.produto.preco * item.quantidade | currency : 'BRL' }}</td>
              <td>
                <button
                  class="btn btn-sm btn-outline-danger"
                  (click)="removerDoCarrinho(item.itemId)"
                >
                  Remover
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="row justify-content-end mt-4">
        <div class="col-md-6 mb-3">
          <h4 class="mb-3">Calcular Frete</h4>
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              placeholder="Digite seu CEP"
              [(ngModel)]="cepDestino"
              maxlength="9"
            />
            <button
              class="btn btn-outline-light"
              type="button"
              (click)="onClickCalcularFrete()"
              [disabled]="calculandoFrete"
            >
              <span *ngIf="!calculandoFrete">Calcular</span>
              <span
                *ngIf="calculandoFrete"
                class="spinner-border spinner-border-sm"
                role="status"
              ></span>
            </button>
          </div>
          <div *ngIf="opcaoFrete" class="mt-3 p-3 bg-dark-subtle text-dark rounded">
            <strong>Opção de Entrega:</strong> {{ opcaoFrete.regiao }}
            <br />
            <strong>Prazo:</strong> {{ opcaoFrete.prazo }}
            <br />
            <strong class="text-success">Valor: {{ opcaoFrete.valor | currency : 'BRL' }}</strong>
          </div>
        </div>
        <div class="col-md-6">
          <div class="text-end bg-dark p-4 rounded">
            <h5 class="mb-3">Resumo do Pedido</h5>
            <div class="d-flex justify-content-between">
              <span>Subtotal (Produtos):</span>
              <span>{{ totalProdutos | currency : 'BRL' }}</span>
            </div>
            <div *ngIf="opcaoFrete" class="d-flex justify-content-between mt-2">
              <span>Frete ({{ opcaoFrete.regiao }}):</span>
              <span>{{ opcaoFrete.valor | currency : 'BRL' }}</span>
            </div>
            <hr class="border-light" />
            <div class="d-flex justify-content-between h4">
              <span class="fw-bold">Total:</span>
              <span class="fw-bold text-success">{{ getTotalGeral() | currency : 'BRL' }}</span>
            </div>
            <a routerLink="/finalizar-compra" class="btn btn-primary btn-lg w-100 mt-3">
              Finalizar Compra
            </a>
          </div>
        </div>
      </div>
    </div>

    <ng-template #carrinhoVazio>
      <div class="alert alert-light text-center text-dark" role="alert">
        Seu carrinho está vazio. Volte para a
        <a routerLink="/camisas/brasileirao" class="alert-link">loja</a>!
      </div>
    </ng-template>
  </div>
</section>
