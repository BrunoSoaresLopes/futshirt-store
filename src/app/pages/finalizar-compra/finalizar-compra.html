<section class="py-5 text-white">
  <div class="container px-4 px-lg-5">

    <h2 class="text-center mb-4 text-white">Finalizar Compra</h2>

    <div class="row g-5">

      <div class="col-md-7">

        <h4 class="mb-3 text-white">Informações do Comprador</h4>

        <form [formGroup]="checkoutForm" (ngSubmit)="onSubmit()" novalidate>

          <div class="row g-3">
            <div class="col-12">
              <label for="nomeCompleto" class="form-label">Nome Completo</label>
              <input type="text" class="form-control" id="nomeCompleto" formControlName="nomeCompleto"
                     [ngClass]="{ 'is-invalid': f['nomeCompleto'].invalid && f['nomeCompleto'].touched }">
              <div *ngIf="f['nomeCompleto'].invalid && f['nomeCompleto'].touched" class="invalid-feedback d-block small">
                <div *ngIf="f['nomeCompleto'].errors?.['required']">Nome é obrigatório.</div>
                <div *ngIf="f['nomeCompleto'].errors?.['minlength']">Nome muito curto.</div>
              </div>
            </div>

            <div class="col-12">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" formControlName="email"
                     [ngClass]="{ 'is-invalid': f['email'].invalid && f['email'].touched }">
              <div *ngIf="f['email'].invalid && f['email'].touched" class="invalid-feedback d-block small">
                <div *ngIf="f['email'].errors?.['required']">Email é obrigatório.</div>
                <div *ngIf="f['email'].errors?.['email']">Formato de email inválido.</div>
              </div>
            </div>
          </div>

          <hr class="my-4 border-light"> <h4 class="mb-3 text-white">Endereço de Entrega</h4>
          <div class="row g-3">
            <div class="col-md-5">
              <label for="cep" class="form-label">CEP</label>
              <input type="text" class="form-control" id="cep" formControlName="cep" placeholder="XXXXX-XXX"
                     [ngClass]="{ 'is-invalid': f['cep'].invalid && f['cep'].touched }">
              <div *ngIf="f['cep'].invalid && f['cep'].touched" class="invalid-feedback d-block small">
                <div *ngIf="f['cep'].errors?.['required']">CEP é obrigatório.</div>
                <div *ngIf="f['cep'].errors?.['pattern']">Formato de CEP inválido.</div>
              </div>
            </div>

            <div class="col-md-7">
              <label for="rua" class="form-label">Rua / Avenida</label>
              <input type="text" class="form-control" id="rua" formControlName="rua"
                     [ngClass]="{ 'is-invalid': f['rua'].invalid && f['rua'].touched }">
              <div *ngIf="f['rua'].invalid && f['rua'].touched" class="invalid-feedback d-block small">
                Rua é obrigatória.
              </div>
            </div>

            <div class="col-md-4">
              <label for="numero" class="form-label">Número</label>
              <input type="text" class="form-control" id="numero" formControlName="numero"
                     [ngClass]="{ 'is-invalid': f['numero'].invalid && f['numero'].touched }">
              <div *ngIf="f['numero'].invalid && f['numero'].touched" class="invalid-feedback d-block small">
                <div *ngIf="f['numero'].errors?.['required']">Nº obrigatório.</div>
                <div *ngIf="f['numero'].errors?.['pattern']">Apenas números.</div>
              </div>
            </div>

             <div class="col-md-8">
              <label for="bairro" class="form-label">Bairro</label>
              <input type="text" class="form-control" id="bairro" formControlName="bairro"
                     [ngClass]="{ 'is-invalid': f['bairro'].invalid && f['bairro'].touched }">
              <div *ngIf="f['bairro'].invalid && f['bairro'].touched" class="invalid-feedback d-block small">
                Bairro é obrigatório.
              </div>
            </div>

            <div class="col-12">
              <label for="cidade" class="form-label">Cidade</label>
              <input type="text" class="form-control" id="cidade" formControlName="cidade"
                     [ngClass]="{ 'is-invalid': f['cidade'].invalid && f['cidade'].touched }">
              <div *ngIf="f['cidade'].invalid && f['cidade'].touched" class="invalid-feedback d-block small">
                Cidade é obrigatória.
              </div>
            </div>
          </div>

          <hr class="my-4 border-light"> <h4 class="mb-3 text-white">Pagamento</h4>
          <div class="row g-3">
            <div class="col-12">
              <label for="nomeCartao" class="form-label">Nome no Cartão</label>
              <input type="text" class="form-control" id="nomeCartao" formControlName="nomeCartao"
                     [ngClass]="{ 'is-invalid': f['nomeCartao'].invalid && f['nomeCartao'].touched }">
              <div *ngIf="f['nomeCartao'].invalid && f['nomeCartao'].touched" class="invalid-feedback d-block small">
                Nome no cartão é obrigatório.
              </div>
            </div>

            <div class="col-12">
              <label for="numeroCartao" class="form-label">Número do Cartão</label>
              <input type="text" class="form-control" id="numeroCartao" formControlName="numeroCartao" placeholder="XXXX XXXX XXXX XXXX"
                     [ngClass]="{ 'is-invalid': f['numeroCartao'].invalid && f['numeroCartao'].touched }">
              <div *ngIf="f['numeroCartao'].invalid && f['numeroCartao'].touched" class="invalid-feedback d-block small">
                <div *ngIf="f['numeroCartao'].errors?.['required']">Nº do cartão é obrigatório.</div>
                <div *ngIf="f['numeroCartao'].errors?.['pattern']">Deve conter 16 números.</div>
              </div>
            </div>

            <div class="col-md-6">
              <label for="validadeCartao" class="form-label">Validade (MM/AA)</label>
              <input type="text" class="form-control" id="validadeCartao" formControlName="validadeCartao" placeholder="MM/AA"
                     [ngClass]="{ 'is-invalid': f['validadeCartao'].invalid && f['validadeCartao'].touched }">
              <div *ngIf="f['validadeCartao'].invalid && f['validadeCartao'].touched" class="invalid-feedback d-block small">
                Validade inválida (use MM/AA).
              </div>
            </div>

            <div class="col-md-6">
              <label for="cvv" class="form-label">CVV</label>
              <input type="text" class="form-control" id="cvv" formControlName="cvv" placeholder="XXX"
                     [ngClass]="{ 'is-invalid': f['cvv'].invalid && f['cvv'].touched }">
              <div *ngIf="f['cvv'].invalid && f['cvv'].touched" class="invalid-feedback d-block small">
                CVV inválido (3 ou 4 dígitos).
              </div>
            </div>
          </div>

          <hr class="my-4 border-light"> <button class="w-100 btn btn-primary btn-lg" type="submit" [disabled]="checkoutForm.invalid">
            Finalizar Compra
          </button>
        </form>

      </div>

      <div class="col-md-5">

        <h4 class="d-flex justify-content-between align-items-center mb-3 text-white">
          <span>Resumo do Pedido</span>
          <span class="badge bg-primary rounded-pill">{{ (itens$ | async)?.length || 0 }}</span>
        </h4>

        <ul class="list-group mb-3 list-group-flush">
          <li *ngFor="let item of (itens$ | async)" class="list-group-item d-flex justify-content-between lh-sm bg-dark text-white">
            <div>
              <h6 class="my-0">{{ item.produto.nome }} ({{ item.tamanho }})</h6>
              <small class="text-white-50">Qtd: {{ item.quantidade }}</small>
            </div>
            <span class="text-white-50">{{ (item.produto.preco * item.quantidade) | currency:'BRL' }}</span>
          </li>

          <li class="list-group-item d-flex justify-content-between bg-dark text-white">
            <span class="fw-bold">Total (Produtos)</span>
            <strong class="fw-bold">{{ totalProdutos | currency:'BRL' }}</strong>
          </li>
        </ul>

      </div>
    </div>
  </div>
</section>
